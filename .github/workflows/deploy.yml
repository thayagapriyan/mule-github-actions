name: Deploy to CloudHub

on:
    push:
        branches: [main]
    workflow_dispatch:

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest

        steps:
            - name: Checkout code
              uses: actions/checkout@v4

            - name: Set up JDK 17
              uses: actions/setup-java@v4
              with:
                  java-version: "17"
                  distribution: "temurin"
                  cache: maven

            - name: Build and Deploy to CloudHub
              env:
                  ANYPOINT_USERNAME: ${{ secrets.ANYPOINT_USERNAME }}
                  ANYPOINT_PASSWORD: ${{ secrets.ANYPOINT_PASSWORD }}
                  ANYPOINT_ORG_ID: ${{ secrets.ANYPOINT_ORG_ID }}
                  ANYPOINT_ENV: ${{ secrets.ANYPOINT_ENV }}
              run: |
                  mvn clean deploy -DmuleDeploy \
                    -Danypoint.username=$ANYPOINT_USERNAME \
                    -Danypoint.password=$ANYPOINT_PASSWORD \
                    -Danypoint.organizationId=$ANYPOINT_ORG_ID \
                    -Danypoint.environment=$ANYPOINT_ENV
